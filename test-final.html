<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Berita - Final Verification</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .news-item { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 4px; }
        .news-title { font-weight: bold; color: #333; }
        .news-meta { color: #666; font-size: 0.9em; margin: 5px 0; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 Test Berita SMPIT DTI - Final Verification</h1>
        
        <div id="status" class="status info">
            Memulai test...
        </div>

        <button onclick="testAll()">🔄 Run All Tests</button>
        <button onclick="window.open('https://smpitdaaruttarbiyah.github.io/smpit-dti-web/', '_blank')">🌐 Buka Website Utama</button>

        <div id="results"></div>

        <h2>📰 Data Berita Saat Ini:</h2>
        <div id="newsData"></div>
    </div>

    <script>
        let testResults = [];

        function updateStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.className = `status ${type}`;
            statusEl.textContent = message;
        }

        function addResult(test, status, details) {
            testResults.push({ test, status, details });
            updateResults();
        }

        function updateResults() {
            const resultsEl = document.getElementById('results');
            resultsEl.innerHTML = '<h2>📋 Test Results:</h2>' + 
                testResults.map(r => `
                    <div class="status ${r.status === '✅' ? 'success' : r.status === '❌' ? 'error' : 'info'}">
                        <strong>${r.test}:</strong> ${r.status} ${r.details}
                    </div>
                `).join('');
        }

        async function testGitHubAPI() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/SMPITdaaruttarbiyah/smpit-dti-web/main/assets/data/news.json');
                if (response.ok) {
                    const data = await response.json();
                    addResult('GitHub API Access', '✅', `${data.news.length} berita ditemukan`);
                    return data;
                } else {
                    addResult('GitHub API Access', '❌', `HTTP ${response.status}`);
                    return null;
                }
            } catch (error) {
                addResult('GitHub API Access', '❌', error.message);
                return null;
            }
        }

        async function testWebsiteAccess() {
            try {
                const response = await fetch('https://smpitdaaruttarbiyah.github.io/smpit-dti-web/');
                if (response.ok) {
                    const html = await response.text();
                    const hasNewsLoader = html.includes('news-loader.js');
                    const hasNewsSection = html.includes('id="news"');
                    
                    if (hasNewsLoader && hasNewsSection) {
                        addResult('Website Access', '✅', 'News loader dan section ditemukan');
                    } else {
                        addResult('Website Access', '⚠️', 'Website accessible tapi news components tidak lengkap');
                    }
                } else {
                    addResult('Website Access', '❌', `HTTP ${response.status}`);
                }
            } catch (error) {
                addResult('Website Access', '❌', error.message);
            }
        }

        async function testNewsLoader() {
            try {
                const response = await fetch('https://smpitdaaruttarbiyah.github.io/smpit-dti-web/assets/js/news-loader.js');
                if (response.ok) {
                    const js = await response.text();
                    const hasFetchLogic = js.includes('fetch(') && js.includes('github.com');
                    const hasDisplayLogic = js.includes('createNewsCard');
                    
                    if (hasFetchLogic && hasDisplayLogic) {
                        addResult('News Loader Script', '✅', 'Script lengkap dengan fetch dan display logic');
                    } else {
                        addResult('News Loader Script', '⚠️', 'Script ada tapi mungkin tidak lengkap');
                    }
                } else {
                    addResult('News Loader Script', '❌', `HTTP ${response.status}`);
                }
            } catch (error) {
                addResult('News Loader Script', '❌', error.message);
            }
        }

        function displayNewsData(data) {
            const newsDataEl = document.getElementById('newsData');
            if (data && data.news) {
                newsDataEl.innerHTML = data.news.map(item => `
                    <div class="news-item">
                        <div class="news-title">${item.title}</div>
                        <div class="news-meta">
                            📅 ${formatDate(item.date)} | 
                            🏷️ ${item.category} | 
                            🆔 ${item.id}
                        </div>
                        <div>${item.content.substring(0, 150)}...</div>
                        ${item.tags ? `<div><strong>Tags:</strong> ${item.tags}</div>` : ''}
                    </div>
                `).join('');
            } else {
                newsDataEl.innerHTML = '<div class="status error">Tidak ada data berita</div>';
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', {
                day: 'numeric', 
                month: 'long', 
                year: 'numeric'
            });
        }

        async function testAll() {
            updateStatus('🔄 Menjalankan semua test...', 'info');
            testResults = [];

            // Test 1: GitHub API
            const newsData = await testGitHubAPI();
            
            // Test 2: Website Access
            await testWebsiteAccess();
            
            // Test 3: News Loader Script
            await testNewsLoader();

            // Display news data
            displayNewsData(newsData);

            // Final status
            const successCount = testResults.filter(r => r.status === '✅').length;
            const totalTests = testResults.length;
            
            if (successCount === totalTests) {
                updateStatus(`🎉 Semua test berhasil! (${successCount}/${totalTests})`, 'success');
            } else {
                updateStatus(`⚠️ ${successCount}/${totalTests} test berhasil`, 'error');
            }
        }

        // Auto-run on page load
        window.addEventListener('load', () => {
            setTimeout(testAll, 1000);
        });
    </script>
</body>
</html>